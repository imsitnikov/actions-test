import React from 'react';
import { ChevronLeft, ChevronRight } from '@gravity-ui/icons';
import { Button, Icon } from '@gravity-ui/uikit';
import { MediaRenderer } from '../../../Stories/components';
import { block } from '../../../utils/cn';
import './StoriesPreview.css';
const PREVIEW_ITEM_SIZE = 40;
const PREVIEW_LIST_GAP = 8;
const b = block('stories-group-preview');
const PreviewItem = ({ active, disabled, groupIndex, media, onSelectGroup }) => {
    const onClick = React.useCallback((event) => {
        event.preventDefault();
        event.stopPropagation();
        onSelectGroup === null || onSelectGroup === void 0 ? void 0 : onSelectGroup(groupIndex);
    }, [onSelectGroup, groupIndex]);
    return (
    // eslint-disable-next-line jsx-a11y/click-events-have-key-events, jsx-a11y/no-static-element-interactions
    React.createElement("div", { className: b('stories-preview-item', {
            active,
            disabled,
        }), onClick: onClick }, media && React.createElement(MediaRenderer, { media: media })));
};
const StoriesPreviewList = ({ groupIndex, groups, onGroupSelect, offset = 0, }) => {
    return (React.createElement(React.Fragment, null, groups.map(({ thumbnailMedia, items }, i) => {
        var _a;
        const media = thumbnailMedia || ((_a = items[0]) === null || _a === void 0 ? void 0 : _a.media);
        const currentGroupIndex = offset + i;
        return (React.createElement(PreviewItem, { key: i, groupIndex: currentGroupIndex, active: currentGroupIndex === groupIndex, disabled: items.length === 0, media: media, onSelectGroup: onGroupSelect }));
    })));
};
const StoriesPreviewListWithSlider = ({ groupIndex, groups, onGroupSelect, maxSliderItemsCount, }) => {
    const [offset, setOffset] = React.useState(0);
    React.useEffect(() => {
        const currentOffset = maxSliderItemsCount * Math.floor(groupIndex / maxSliderItemsCount);
        setOffset(currentOffset);
    }, [groupIndex, maxSliderItemsCount]);
    const setPreviewOffset = React.useCallback((event) => {
        event.preventDefault();
        event.stopPropagation();
        setOffset((currentOffset) => {
            return currentOffset - maxSliderItemsCount;
        });
    }, [maxSliderItemsCount]);
    const setNextOffset = React.useCallback((event) => {
        event.preventDefault();
        event.stopPropagation();
        setOffset((currentOffset) => {
            return currentOffset + maxSliderItemsCount;
        });
    }, [maxSliderItemsCount]);
    return (React.createElement(React.Fragment, null,
        groups.length > maxSliderItemsCount && (React.createElement("div", { className: b('slider-button-wrapper') }, offset !== 0 && (React.createElement(Button, { view: "raised", pin: "circle-circle", onClick: setPreviewOffset },
            React.createElement(Icon, { data: ChevronLeft }))))),
        React.createElement("div", { className: b('slider-preview-list-wrapper'), style: {
                width: `${PREVIEW_ITEM_SIZE * maxSliderItemsCount +
                    PREVIEW_LIST_GAP * (maxSliderItemsCount - 1)}px`,
            } },
            React.createElement(StoriesPreviewList, { groupIndex: groupIndex, groups: groups.slice(offset, offset + maxSliderItemsCount), onGroupSelect: onGroupSelect, offset: offset })),
        groups.length > maxSliderItemsCount && (React.createElement("div", { className: b('slider-button-wrapper') }, offset < groups.length - maxSliderItemsCount && (React.createElement(Button, { view: "raised", pin: "circle-circle", onClick: setNextOffset },
            React.createElement(Icon, { data: ChevronRight })))))));
};
// all onClick handlers of StoriesPreview childrens should have preventDefault() and stopPropagation() callings
export const StoriesPreview = ({ groups, groupIndex, onGroupSelect, maxSliderItemsCount, onClose, }) => {
    const handleClose = React.useCallback((event) => {
        onClose === null || onClose === void 0 ? void 0 : onClose(event, 'outsideClick');
    }, [onClose]);
    if (groups.length < maxSliderItemsCount) {
        return (
        // eslint-disable-next-line jsx-a11y/click-events-have-key-events, jsx-a11y/no-static-element-interactions
        React.createElement("div", { className: b(), onClick: handleClose },
            React.createElement(StoriesPreviewList, { groupIndex: groupIndex, groups: groups, onGroupSelect: onGroupSelect })));
    }
    return (
    // eslint-disable-next-line jsx-a11y/click-events-have-key-events, jsx-a11y/no-static-element-interactions
    React.createElement("div", { className: b(), onClick: handleClose },
        React.createElement(StoriesPreviewListWithSlider, { maxSliderItemsCount: maxSliderItemsCount, groupIndex: groupIndex, groups: groups, onGroupSelect: onGroupSelect })));
};
