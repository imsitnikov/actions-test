"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.NotificationWrapper = void 0;
const react_1 = __importDefault(require("react"));
const uikit_1 = require("@gravity-ui/uikit");
const Notification_1 = require("../Notification");
const NotificationWithSwipe_1 = require("../Notification/NotificationWithSwipe");
const cn_1 = require("../utils/cn");
require("./Notifications.css");
const b = (0, cn_1.block)('notifications');
const NotificationWrapper = (props) => {
    const ref = react_1.default.useRef(null);
    const { notification, swipeThreshold } = props;
    const mobile = (0, uikit_1.useMobile)();
    const [wrapperMaxHeight, setWrapperMaxHeight] = react_1.default.useState(undefined);
    const [isRemoved, setIsRemoved] = react_1.default.useState(false);
    react_1.default.useEffect(() => {
        if (!ref.current) {
            if (!notification.archived && isRemoved) {
                setIsRemoved(false);
            }
            return () => { };
        }
        if (notification.archived) {
            const listener = (event) => {
                var _a;
                if (event.propertyName === 'max-height') {
                    setIsRemoved(true);
                    (_a = ref.current) === null || _a === void 0 ? void 0 : _a.removeEventListener('transitionend', listener);
                }
            };
            ref.current.addEventListener('transitionend', listener);
            ref.current.style.transition = 'max-height 0.3s';
            setWrapperMaxHeight(0);
            return () => {
                var _a;
                (_a = ref.current) === null || _a === void 0 ? void 0 : _a.removeEventListener('transitionend', listener);
            };
        }
        else {
            setIsRemoved(false);
            setTimeout(() => {
                var _a, _b;
                if (!ref.current)
                    return;
                ref.current.style.transition = 'none';
                ref.current.style.maxHeight = 'none';
                const maxHeight = (_b = (_a = ref.current) === null || _a === void 0 ? void 0 : _a.getBoundingClientRect().height) !== null && _b !== void 0 ? _b : 0;
                setWrapperMaxHeight(maxHeight);
            }, 0);
            return () => { };
        }
    }, [ref, notification.archived, isRemoved]);
    const style = wrapperMaxHeight === undefined ? {} : { maxHeight: `${wrapperMaxHeight}px` };
    if (isRemoved) {
        return null;
    }
    return (react_1.default.createElement("div", { className: b('notification-wrapper', {
            archived: notification.archived,
            unread: notification.unread,
            active: Boolean(notification.onClick),
        }), ref: ref, style: style }, mobile && notification.swipeActions ? (react_1.default.createElement(NotificationWithSwipe_1.NotificationWithSwipe, { notification: notification, swipeThreshold: swipeThreshold })) : (react_1.default.createElement(Notification_1.Notification, { notification: notification }))));
};
exports.NotificationWrapper = NotificationWrapper;
